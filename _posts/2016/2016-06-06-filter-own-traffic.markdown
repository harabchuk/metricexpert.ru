---
layout: post
title:  "Исключаем свои посещения в Google Analytics при помощи Cookies"
date:   2016-06-06 08:07:33 +0300
categories: ga
---
Для исключения своего трафика в справке Google Analytics [предлагается фильтровать
по IP  адресу][ga-help]. Но мало у кого есть статический IP  адрес, поэтому лучше использовать
более надежный способ – установку куков у сотрудников.

Для этого нужно на сайте разместить секретную страницу. При переходе на нее в
браузере добавляется служебная кука. А в том месте где размещается код Google Analytics
нужно добавить условие: если нет куки, выполнять код аналитики. Затем, попросить
всех сотрудников перейти на секретную страницу.

### На что влияет фильтрация внутреннего трафика

Когда сотрудники деражат открытым свой сайт в течение дня, это влияет на статистику,
например, на среднее время пребывания на сайте. Предположим, среднее время пребывания
посетителей 2 минуты, а сотрудники проводят на сайте по 6-8 часов. Даже при небольшом
количестве сотрудников, это будет влиять на среднюю длительность сессии.

### Как создать секретную страницу

Пример секретной HTML страницы по [этой ссылке][secret-page]. Сохраните ее
и загрузите на ваш сайт. Важно, чтобы страница размещалась на том же домене,
где располагается ваш сайт, чтобы кука установилась для этого домена.

### Исключаем внутренний трафик при помощи куки

Теперь, когда кука установлена, необходимо добавить условие в том месте где размещается
код Google Analytics.

```javascript
if(!document.cookie.match(/_staff/)){  // проверяем, что нет куки _staff
    // код Google Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-XXXXX-X', 'auto');
    ga('send', 'pageview');
}else{
    // пустая функция ga, чтобы не появлялись ошибки при вызове ga('send', 'event'...)
    window.ga = function(a,b,c,d,e,f,g){};
}
```

[ga-help]: https://support.google.com/analytics/answer/1034840?hl=ru
[secret-page]: https://gist.githubusercontent.com/ahsipuni/07880e04e0981e6142f2e96d2cedfee9/raw/d241c4a14b5eb523609a45165faff3d73d9cfeaa/staff_cookie.html
